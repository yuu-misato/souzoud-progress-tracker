<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiERU - ä½œæ¥­è€…ç”»é¢</title>
    <meta name="description" content="ä½œæ¥­è€…ç”¨ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/index.css">
    <style>
        /* =============================================
           Worker Dashboard Styles (matching admin.html)
           ============================================= */

        /* Worker Layout */
        .admin-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: var(--space-6);
            min-height: calc(100vh - 140px);
        }

        /* Sidebar */
        .admin-sidebar {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            height: fit-content;
            position: sticky;
            top: var(--space-4);
        }

        .admin-sidebar__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--color-border);
        }

        .admin-sidebar__title {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .project-nav {
            list-style: none;
        }

        .project-nav__group {
            margin-bottom: var(--space-4);
        }

        .project-nav__group-name {
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-muted);
            padding: var(--space-2) var(--space-2);
            margin-bottom: var(--space-1);
        }

        .project-nav__item {
            display: block;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            font-size: var(--font-size-sm);
        }

        .project-nav__item:hover {
            background: var(--color-bg-secondary);
        }

        .project-nav__item--active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--color-primary);
            font-weight: 500;
        }

        /* Main Content */
        .admin-main {
            min-width: 0;
        }

        /* Dashboard Welcome */
        .dashboard-welcome {
            margin-bottom: var(--space-6);
        }

        .dashboard-welcome__title {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            margin-bottom: var(--space-2);
        }

        .dashboard-welcome__subtitle {
            color: var(--color-text-muted);
            font-size: var(--font-size-sm);
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .stat-card-simple {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
        }

        .stat-card-simple__value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: var(--space-1);
        }

        .stat-card-simple__label {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
        }

        /* This Week Task List */
        .week-task-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .week-task-item:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-sm);
        }
        .week-task-item__due {
            min-width: 80px;
            text-align: center;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        .week-task-item__due--overdue {
            background: #fef2f2;
            color: #dc2626;
        }
        .week-task-item__due--today {
            background: #fef3c7;
            color: #d97706;
        }
        .week-task-item__due--tomorrow {
            background: #fef9c3;
            color: #ca8a04;
        }
        .week-task-item__due--soon {
            background: #ecfdf5;
            color: #059669;
        }
        .week-task-item__content {
            flex: 1;
            min-width: 0;
        }
        .week-task-item__project {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            margin-bottom: var(--space-1);
        }
        .week-task-item__step {
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--color-text);
        }
        .week-task-item__client {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-top: var(--space-1);
        }
        .week-task-item__status {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            background: var(--color-bg-secondary);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
        }

        /* Task Editor Card */
        .editor-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
        }

        .editor-card__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--color-border);
        }

        .editor-card__title {
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .editor-card__body {
            padding: var(--space-5);
        }

        /* Task Description (Specs) */
        .task-description-display {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 3px solid #3b82f6;
            padding: var(--space-4);
            border-radius: var(--radius-md);
            margin: var(--space-3) 0;
            font-size: var(--font-size-sm);
            color: var(--color-text);
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* Task Notes */
        .task-notes-display {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border-left: 3px solid #eab308;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            margin: var(--space-3) 0;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            white-space: pre-wrap;
        }

        /* Submission History */
        .submission-item {
            display: flex;
            padding: var(--space-4);
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-3);
        }
        .submission-item--approved {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left: 4px solid #10b981;
        }
        .submission-item--rejected {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid #ef4444;
        }
        .submission-item--submitted {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 4px solid #f59e0b;
        }
        .submission-status-badge {
            font-size: var(--font-size-xs);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-weight: 500;
        }
        .submission-status-badge--submitted {
            background: #fef3c7;
            color: #d97706;
        }
        .submission-status-badge--approved {
            background: #d1fae5;
            color: #059669;
        }
        .submission-status-badge--rejected {
            background: #fee2e2;
            color: #dc2626;
        }
        .submission-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-sm);
            color: var(--color-primary);
            text-decoration: none;
            padding: var(--space-1) var(--space-2);
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--radius-sm);
            transition: background var(--transition-fast);
        }
        .submission-link:hover {
            background: rgba(99, 102, 241, 0.2);
        }
        .submission-comment {
            background: rgba(0, 0, 0, 0.03);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            margin-top: var(--space-2);
        }
        .submission-feedback {
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            margin-top: var(--space-2);
        }
        .submission-feedback--rejected {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        .submission-feedback--approved {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .admin-layout {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                position: static;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header header--minimal">
        <div class="container">
            <div class="header__inner">
                <a href="#" id="logo-dashboard-link" class="header__logo">
                    <span class="header__logo-text">MiERU</span>
                    <span class="header__logo-badge">ä½œæ¥­è€…</span>
                </a>
                <!-- Desktop Menu -->
                <nav class="header__nav header__menu-desktop">
                    <span id="worker-name" class="header__admin-name"></span>
                    <button id="dashboard-btn" class="btn btn--ghost btn--sm" style="display: none;">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                    <a id="switch-to-admin-btn" href="/admin.html" class="btn btn--outline btn--sm" style="display: none;">ğŸ“Š ç®¡ç†ç”»é¢</a>
                    <button id="logout-btn" class="btn btn--ghost btn--sm">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </nav>

                <!-- Mobile Menu -->
                <div class="header__mobile-wrapper">
                    <button id="mobile-menu-btn" class="header__menu-toggle">
                        <span class="header__menu-icon">â˜°</span>
                    </button>
                    <div id="mobile-menu" class="header__mobile-menu">
                        <button id="mobile-dashboard-btn" class="header__mobile-item" style="display: none;">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                        <a id="mobile-switch-to-admin-btn" href="/admin.html" class="header__mobile-item" style="display: none;">ğŸ“Š ç®¡ç†ç”»é¢ã¸</a>
                        <div class="header__mobile-divider"></div>
                        <button id="mobile-logout-btn" class="header__mobile-item header__mobile-item--logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <style>
        .header--minimal {
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-6);
        }
        .header__inner {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-direction: row !important;
        }
        .header__logo-badge {
            font-size: var(--font-size-xs);
            background: var(--color-bg-secondary);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            margin-left: var(--space-2);
            color: var(--color-text-muted);
        }
        .header__admin-name {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            margin-right: var(--space-3);
        }
        .header__menu-desktop {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .header__mobile-wrapper {
            display: none;
            position: relative;
        }
        .header__menu-toggle {
            background: none;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-2) var(--space-3);
            cursor: pointer;
            font-size: var(--font-size-lg);
        }
        .header__mobile-menu {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            min-width: 200px;
            z-index: 100;
            padding: var(--space-2);
        }
        .header__mobile-menu.active {
            display: block;
        }
        .header__mobile-item {
            display: block;
            width: 100%;
            padding: var(--space-3) var(--space-4);
            text-align: left;
            background: none;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            color: var(--color-text);
            text-decoration: none;
            transition: background var(--transition-fast);
        }
        .header__mobile-item:hover {
            background: var(--color-bg-secondary);
        }
        .header__mobile-item--logout {
            color: #ef4444;
        }
        .header__mobile-divider {
            height: 1px;
            background: var(--color-border);
            margin: var(--space-2) 0;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤º */
        @media (max-width: 768px) {
            .header__admin-name {
                display: none;
            }
            .header__menu-desktop {
                display: none;
            }
            .header__mobile-wrapper {
                display: block;
            }
        }

        /* Footer */
        .footer-minimal {
            text-align: center;
            padding: var(--space-8) 0;
            color: var(--color-text-muted);
            font-size: var(--font-size-sm);
            margin-top: var(--space-8);
        }
        .footer-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        .footer-link {
            color: var(--color-text-muted);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        .footer-link:hover {
            color: var(--color-primary);
        }
        .footer-link--active {
            color: var(--color-primary);
            font-weight: 500;
        }
        .footer-divider {
            color: var(--color-border);
        }
    </style>

    <!-- Login Section -->
    <section id="login-section" class="login-section show">
        <div class="login-card-simple">
            <div class="login-card-simple__header">
                <div class="login-card-simple__logo">MiERU</div>
                <div class="login-card-simple__subtitle">ä½œæ¥­è€…ãƒ­ã‚°ã‚¤ãƒ³</div>
            </div>
            <div id="login-error" class="login-error" style="display: none;"></div>
            <form id="login-form">
                <div class="form-field">
                    <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" class="input" placeholder="email@example.com" required>
                </div>
                <div class="form-field">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" class="input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
                </div>
                <button type="submit" class="btn btn--primary" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
        </div>
    </section>

    <style>
        .login-section {
            display: none;
        }
        .login-section.show {
            display: block;
        }
        .login-card-simple {
            max-width: 360px;
            margin: var(--space-10) auto;
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
        }
        .login-card-simple__header {
            text-align: center;
            margin-bottom: var(--space-6);
        }
        .login-card-simple__logo {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
        }
        .login-card-simple__subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
        }
        .form-field {
            margin-bottom: var(--space-4);
        }
        .form-field label {
            display: block;
            margin-bottom: var(--space-2);
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--color-text-secondary);
        }
        .login-error {
            background: #fef2f2;
            color: #dc2626;
            padding: var(--space-3);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-4);
            font-size: var(--font-size-sm);
        }

        @media (max-width: 480px) {
            .login-card-simple {
                margin: var(--space-6) auto;
                padding: var(--space-5);
                border-radius: var(--radius-lg);
            }
        }
    </style>

    <!-- Main Content (after login) -->
    <main id="main-content" class="container" style="display: none;">
        <div class="admin-layout">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="admin-sidebar__header">
                    <span class="admin-sidebar__title">æ‹…å½“ã‚¿ã‚¹ã‚¯</span>
                </div>
                <ul class="project-nav" id="task-list-sidebar">
                    <!-- Tasks will be rendered here -->
                </ul>
            </aside>

            <!-- Main Content -->
            <div class="admin-main">
                <!-- Dashboard (shown by default) -->
                <div id="worker-dashboard">
                    <!-- Simple Welcome -->
                    <div class="dashboard-welcome">
                        <h1 class="dashboard-welcome__title" id="greeting">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                        <p class="dashboard-welcome__subtitle" id="today-date">å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                    </div>

                    <!-- Simple Stats -->
                    <div class="stats-row">
                        <div class="stat-card-simple" id="stat-pending">
                            <div class="stat-card-simple__value">-</div>
                            <div class="stat-card-simple__label">æœªç€æ‰‹</div>
                        </div>
                        <div class="stat-card-simple" id="stat-in-progress">
                            <div class="stat-card-simple__value">-</div>
                            <div class="stat-card-simple__label">ä½œæ¥­ä¸­</div>
                        </div>
                        <div class="stat-card-simple" id="stat-submitted">
                            <div class="stat-card-simple__value">-</div>
                            <div class="stat-card-simple__label">ç¢ºèªå¾…ã¡</div>
                        </div>
                    </div>

                    <!-- Upcoming Deadlines Section (7 days) -->
                    <div id="this-week-tasks-section" class="dashboard-section" style="margin-top: var(--space-6);">
                        <h3 style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                            ğŸ“… 7æ—¥ä»¥å†…ã®æå‡ºæœŸé™
                            <span id="this-week-tasks-count" style="font-size: var(--font-size-sm); background: var(--color-primary); color: white; padding: var(--space-1) var(--space-2); border-radius: var(--radius-full);">0</span>
                        </h3>
                        <div id="this-week-tasks-list" class="task-list">
                            <div class="empty-state">
                                <div class="empty-state__icon">âœ…</div>
                                <div>7æ—¥ä»¥å†…ã®æå‡ºæœŸé™ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Editor -->
                <div id="task-editor" style="display: none;">
                    <!-- Task Header -->
                    <div class="editor-card">
                        <div class="editor-card__header">
                            <div>
                                <h2 id="editor-task-name" class="editor-card__title">-</h2>
                                <p id="editor-project-name" style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: var(--space-1);">-</p>
                            </div>
                            <div style="display: flex; gap: var(--space-2); align-items: center;">
                                <span id="editor-status-badge" class="status-badge">-</span>
                            </div>
                        </div>
                        <div class="editor-card__body">
                            <div style="display: flex; gap: var(--space-6); flex-wrap: wrap;">
                                <div>
                                    <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-1);">æœŸæ—¥</div>
                                    <div id="editor-due-date" style="font-size: var(--font-size-lg); font-weight: 600;">-</div>
                                </div>
                                <div>
                                    <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-1);">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</div>
                                    <div id="editor-client-name" style="font-size: var(--font-size-sm);">-</div>
                                </div>
                            </div>
                            <div id="editor-description-section" style="margin-top: var(--space-4); display: none;">
                                <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-2);">ğŸ“‹ ä»•æ§˜ãƒ»è¦ä»¶</div>
                                <div id="editor-description" class="task-description-display">-</div>
                            </div>
                            <div id="editor-notes-section" style="margin-top: var(--space-4); display: none;">
                                <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-2);">ğŸ“ æ³¨æ„äº‹é …ï¼ˆã‚ãªãŸã¸ã®ãƒ¡ãƒ¢ï¼‰</div>
                                <div id="editor-notes" class="task-notes-display">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Section -->
                    <div class="editor-card" id="submit-section">
                        <div class="editor-card__header">
                            <h3 class="editor-card__title">ğŸ“¤ æˆæœç‰©ã‚’æå‡º</h3>
                        </div>
                        <div class="editor-card__body">
                            <div class="input-group" style="margin-bottom: var(--space-4);">
                                <label for="submit-url">æˆæœç‰©URLï¼ˆGoogle Driveç­‰ï¼‰</label>
                                <input type="url" id="submit-url" class="input" placeholder="https://drive.google.com/...">
                            </div>
                            <div class="input-group" style="margin-bottom: var(--space-4);">
                                <label for="submit-comment">ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰</label>
                                <textarea id="submit-comment" class="input" rows="3" placeholder="å‚™è€ƒã‚„ç¢ºèªã—ã¦ã»ã—ã„ç‚¹ãŒã‚ã‚Œã°å…¥åŠ›"></textarea>
                            </div>
                            <div style="display: flex; gap: var(--space-2);">
                                <button id="start-working-btn" class="btn btn--secondary">ğŸš€ ä½œæ¥­é–‹å§‹</button>
                                <button id="submit-btn" class="btn btn--primary">ğŸ“¤ æå‡ºã™ã‚‹</button>
                            </div>
                        </div>
                    </div>

                    <!-- Submission History -->
                    <div class="editor-card">
                        <div class="editor-card__header">
                            <h3 class="editor-card__title">ğŸ“‹ æå‡ºå±¥æ­´</h3>
                        </div>
                        <div class="editor-card__body">
                            <div id="submission-history">
                                <div class="empty-state" style="padding: var(--space-4);">
                                    <div>ã¾ã æå‡ºå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-minimal">
        <div class="footer-links">
            <a href="/index.html" class="footer-link">ãŠå®¢æ§˜ç”»é¢</a>
            <span class="footer-divider">|</span>
            <a href="/admin.html" class="footer-link">ç®¡ç†è€…ç”»é¢</a>
            <span class="footer-divider">|</span>
            <a href="/worker.html" class="footer-link footer-link--active">ä½œæ¥­è€…ç”»é¢</a>
        </div>
        <p>Â© 2026 SOUZOUD Inc.</p>
    </footer>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast__icon">âœ“</span>
        <span class="toast__message" id="toast-message">ä¿å­˜ã—ã¾ã—ãŸ</span>
    </div>

    <style>
        .status-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: var(--font-size-xs);
        }
        .status-badge--pending {
            background: #e0e7ff;
            color: #4f46e5;
        }
        .status-badge--in_progress {
            background: #dbeafe;
            color: #2563eb;
        }
        .status-badge--submitted {
            background: #fef3c7;
            color: #d97706;
        }
        .status-badge--approved {
            background: #d1fae5;
            color: #059669;
        }
        .empty-state {
            text-align: center;
            padding: var(--space-6);
            color: var(--color-text-muted);
        }
        .empty-state__icon {
            font-size: 48px;
            margin-bottom: var(--space-3);
        }
    </style>

    <script src="/js/security.js"></script>
    <script src="/js/data.js"></script>
    <script src="/js/notifications.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginSection = document.getElementById('login-section');
            const mainContent = document.getElementById('main-content');
            const workerNameEl = document.getElementById('worker-name');
            const taskListSidebar = document.getElementById('task-list-sidebar');
            const workerDashboard = document.getElementById('worker-dashboard');
            const taskEditor = document.getElementById('task-editor');

            let currentWorker = null;
            let allAssignments = [];
            let selectedTaskId = null;

            // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
            const escapeHtml = (str) => {
                if (typeof SecurityUtils !== 'undefined') {
                    return SecurityUtils.escapeHtml(str);
                }
                if (str === null || str === undefined) return '';
                return String(str)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#x27;');
            };

            // Check existing session
            const session = localStorage.getItem('worker_session');
            if (session) {
                try {
                    const sessionData = JSON.parse(session);
                    if (sessionData.email && sessionData.expiry > Date.now()) {
                        currentWorker = sessionData;
                        showMainContent();
                    } else {
                        localStorage.removeItem('worker_session');
                    }
                } catch (e) {
                    localStorage.removeItem('worker_session');
                }
            }

            // Login form
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                if (typeof SecurityUtils !== 'undefined' && !SecurityUtils.checkRateLimit('worker_login', 5, 60000)) {
                    showError('ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚1åˆ†å¾Œã«å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    return;
                }

                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                try {
                    const passwordHash = await hashPassword(password);
                    const workers = await SupabaseClient.select('workers', `email=eq.${encodeURIComponent(email)}&is_active=eq.true`);

                    if (workers.length === 0) {
                        showError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                        return;
                    }

                    const worker = workers[0];
                    if (worker.password_hash === passwordHash) {
                        currentWorker = {
                            id: worker.id,
                            email: worker.email,
                            name: worker.name,
                            expiry: Date.now() + (24 * 60 * 60 * 1000)
                        };
                        localStorage.setItem('worker_session', JSON.stringify(currentWorker));
                        showMainContent();
                    } else {
                        showError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            });

            // Logout handlers
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('mobile-logout-btn').addEventListener('click', logout);

            function logout() {
                localStorage.removeItem('worker_session');
                currentWorker = null;
                loginSection.classList.add('show');
                mainContent.style.display = 'none';
            }

            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('active');
            });
            document.addEventListener('click', (e) => {
                if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                    mobileMenu.classList.remove('active');
                }
            });

            // Dashboard button
            document.getElementById('dashboard-btn').addEventListener('click', showDashboard);
            document.getElementById('mobile-dashboard-btn').addEventListener('click', () => {
                showDashboard();
                mobileMenu.classList.remove('active');
            });
            document.getElementById('logo-dashboard-link').addEventListener('click', (e) => {
                e.preventDefault();
                showDashboard();
            });

            // Show main content after login
            async function showMainContent() {
                loginSection.classList.remove('show');
                mainContent.style.display = 'block';
                workerNameEl.textContent = currentWorker.name;

                // Show dashboard button
                document.getElementById('dashboard-btn').style.display = 'inline-flex';
                document.getElementById('mobile-dashboard-btn').style.display = 'block';

                // Check if worker is also an admin
                if (currentWorker.email) {
                    const adminAccount = await DataManager.getAdminByEmail(currentWorker.email);
                    if (adminAccount) {
                        document.getElementById('switch-to-admin-btn').style.display = 'inline-flex';
                        document.getElementById('mobile-switch-to-admin-btn').style.display = 'block';
                    }
                }

                // Set greeting
                const hour = new Date().getHours();
                let greeting = 'ã“ã‚“ã«ã¡ã¯';
                if (hour < 12) greeting = 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™';
                else if (hour >= 18) greeting = 'ãŠç–²ã‚Œæ§˜ã§ã™';
                document.getElementById('greeting').textContent = `${greeting}ã€${escapeHtml(currentWorker.name)}ã•ã‚“`;
                document.getElementById('today-date').textContent = new Date().toLocaleDateString('ja-JP', {
                    year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'
                });

                await loadTasks();
            }

            // Load tasks
            async function loadTasks() {
                allAssignments = await DataManager.getAssignmentsForWorker(currentWorker.id);

                // Load submissions for each assignment
                for (const assignment of allAssignments) {
                    assignment._submissions = await DataManager.getSubmissionsForAssignment(assignment.id);
                }

                renderSidebar();
                renderStats();
                renderWeekTasks();
            }

            // Render sidebar
            function renderSidebar() {
                if (allAssignments.length === 0) {
                    taskListSidebar.innerHTML = `
                        <li style="padding: var(--space-4); color: var(--color-text-muted); text-align: center;">
                            æ‹…å½“ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“
                        </li>
                    `;
                    return;
                }

                const statusOrder = { pending: 0, in_progress: 1, submitted: 2, approved: 3 };
                const sortedTasks = [...allAssignments].sort((a, b) => {
                    const statusDiff = statusOrder[a.status] - statusOrder[b.status];
                    if (statusDiff !== 0) return statusDiff;
                    if (a.dueDate && b.dueDate) return new Date(a.dueDate) - new Date(b.dueDate);
                    return 0;
                });

                const statusLabels = {
                    pending: 'âšª æœªç€æ‰‹',
                    in_progress: 'ğŸ”µ ä½œæ¥­ä¸­',
                    submitted: 'ğŸŸ¡ ç¢ºèªå¾…ã¡',
                    approved: 'âœ… å®Œäº†'
                };

                let html = '';
                let currentStatus = null;

                for (const task of sortedTasks) {
                    if (task.status !== currentStatus) {
                        currentStatus = task.status;
                        html += `<li class="project-nav__group-name">${statusLabels[currentStatus]}</li>`;
                    }
                    const isActive = task.id === selectedTaskId;
                    html += `
                        <li class="project-nav__item ${isActive ? 'project-nav__item--active' : ''}" data-task-id="${task.id}">
                            ${escapeHtml(task.stepName)}
                            <span style="display: block; font-size: var(--font-size-xs); color: var(--color-text-muted);">
                                ${escapeHtml(task.projectName)}
                            </span>
                        </li>
                    `;
                }

                taskListSidebar.innerHTML = html;

                // Add click handlers
                taskListSidebar.querySelectorAll('.project-nav__item').forEach(item => {
                    item.addEventListener('click', () => {
                        const taskId = item.dataset.taskId;
                        selectTask(taskId);
                    });
                });
            }

            // Render stats
            function renderStats() {
                const stats = {
                    pending: allAssignments.filter(a => a.status === 'pending').length,
                    inProgress: allAssignments.filter(a => a.status === 'in_progress').length,
                    submitted: allAssignments.filter(a => a.status === 'submitted').length
                };

                document.querySelector('#stat-pending .stat-card-simple__value').textContent = stats.pending;
                document.querySelector('#stat-in-progress .stat-card-simple__value').textContent = stats.inProgress;
                document.querySelector('#stat-submitted .stat-card-simple__value').textContent = stats.submitted;
            }

            // Render week tasks (7 days)
            function renderWeekTasks() {
                const now = new Date();
                const weekLater = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

                const weekTasks = allAssignments.filter(a => {
                    if (a.status === 'approved') return false;
                    if (!a.dueDate) return false;
                    const due = new Date(a.dueDate);
                    return due <= weekLater;
                }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                document.getElementById('this-week-tasks-count').textContent = weekTasks.length;

                if (weekTasks.length === 0) {
                    document.getElementById('this-week-tasks-list').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state__icon">âœ…</div>
                            <div>7æ—¥ä»¥å†…ã®æå‡ºæœŸé™ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                        </div>
                    `;
                    return;
                }

                const statusLabels = {
                    pending: 'æœªç€æ‰‹',
                    in_progress: 'ä½œæ¥­ä¸­',
                    submitted: 'ç¢ºèªå¾…ã¡'
                };

                let html = '';
                for (const task of weekTasks) {
                    const due = new Date(task.dueDate);
                    const diffDays = Math.ceil((due - now) / (1000 * 60 * 60 * 24));

                    let dueClass = 'week-task-item__due--soon';
                    let dueText = formatDate(due);

                    if (diffDays < 0) {
                        dueClass = 'week-task-item__due--overdue';
                        dueText = `${Math.abs(diffDays)}æ—¥é…å»¶`;
                    } else if (diffDays === 0) {
                        dueClass = 'week-task-item__due--today';
                        dueText = 'ä»Šæ—¥';
                    } else if (diffDays === 1) {
                        dueClass = 'week-task-item__due--tomorrow';
                        dueText = 'æ˜æ—¥';
                    }

                    html += `
                        <div class="week-task-item" data-task-id="${task.id}">
                            <div class="week-task-item__due ${dueClass}">${dueText}</div>
                            <div class="week-task-item__content">
                                <div class="week-task-item__project">${escapeHtml(task.clientName)} / ${escapeHtml(task.projectName)}</div>
                                <div class="week-task-item__step">${escapeHtml(task.stepName)}</div>
                            </div>
                            <div class="week-task-item__status">${statusLabels[task.status]}</div>
                        </div>
                    `;
                }

                document.getElementById('this-week-tasks-list').innerHTML = html;

                // Add click handlers
                document.querySelectorAll('.week-task-item').forEach(item => {
                    item.addEventListener('click', () => {
                        selectTask(item.dataset.taskId);
                    });
                });
            }

            // Show dashboard
            function showDashboard() {
                selectedTaskId = null;
                workerDashboard.style.display = 'block';
                taskEditor.style.display = 'none';
                renderSidebar();
            }

            // Select task
            function selectTask(taskId) {
                selectedTaskId = taskId;
                const task = allAssignments.find(a => a.id === taskId);
                if (!task) return;

                workerDashboard.style.display = 'none';
                taskEditor.style.display = 'block';
                renderSidebar();

                // Populate editor
                document.getElementById('editor-task-name').textContent = task.stepName;
                document.getElementById('editor-project-name').textContent = `${task.clientName} / ${task.projectName}`;
                document.getElementById('editor-client-name').textContent = task.clientName;

                const statusLabels = {
                    pending: 'æœªç€æ‰‹',
                    in_progress: 'ä½œæ¥­ä¸­',
                    submitted: 'ç¢ºèªå¾…ã¡',
                    approved: 'å®Œäº†'
                };
                const statusBadge = document.getElementById('editor-status-badge');
                statusBadge.textContent = statusLabels[task.status];
                statusBadge.className = `status-badge status-badge--${task.status}`;

                // Due date
                if (task.dueDate) {
                    const due = new Date(task.dueDate);
                    document.getElementById('editor-due-date').textContent = formatDateTime(due);
                } else {
                    document.getElementById('editor-due-date').textContent = 'æœªè¨­å®š';
                }

                // Step description (specs)
                if (task.stepDescription) {
                    document.getElementById('editor-description-section').style.display = 'block';
                    document.getElementById('editor-description').textContent = task.stepDescription;
                } else {
                    document.getElementById('editor-description-section').style.display = 'none';
                }

                // Notes
                if (task.notes) {
                    document.getElementById('editor-notes-section').style.display = 'block';
                    document.getElementById('editor-notes').textContent = task.notes;
                } else {
                    document.getElementById('editor-notes-section').style.display = 'none';
                }

                // Submit section visibility
                const submitSection = document.getElementById('submit-section');
                const startBtn = document.getElementById('start-working-btn');
                const submitBtn = document.getElementById('submit-btn');

                if (task.status === 'approved') {
                    submitSection.style.display = 'none';
                } else {
                    submitSection.style.display = 'block';
                    startBtn.style.display = task.status === 'pending' ? 'inline-flex' : 'none';
                }

                // Clear form
                document.getElementById('submit-url').value = '';
                document.getElementById('submit-comment').value = '';

                // Render submission history
                renderSubmissionHistory(task._submissions || []);
            }

            // Render submission history
            function renderSubmissionHistory(submissions) {
                const container = document.getElementById('submission-history');

                if (submissions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: var(--space-4);">
                            <div>ã¾ã æå‡ºå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
                        </div>
                    `;
                    return;
                }

                const stageLabels = { draft: 'åˆç¨¿', revision: 'ä¿®æ­£ç¨¿', final: 'æœ€çµ‚ç¨¿', submission: 'æå‡º' };
                const statusLabels = { submitted: 'ç¢ºèªä¸­', approved: 'æ‰¿èª', rejected: 'å·®æˆ»ã—' };
                const statusIcons = { submitted: 'â³', approved: 'âœ…', rejected: 'â†©ï¸' };

                let html = '';
                for (const s of submissions.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt))) {
                    html += `
                        <div class="submission-item submission-item--${s.status}">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                    <span style="font-weight: 600;">${statusIcons[s.status]} ${stageLabels[s.stage] || 'æå‡º'}</span>
                                    <span class="submission-status-badge submission-status-badge--${s.status}">${statusLabels[s.status]}</span>
                                </div>
                                <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-2);">
                                    ğŸ“… ${formatDateTime(new Date(s.submittedAt))}
                                </div>
                                ${s.url ? `
                                    <div style="margin-bottom: var(--space-2);">
                                        <a href="${escapeHtml(s.url)}" target="_blank" class="submission-link">
                                            ğŸ“ æå‡ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
                                        </a>
                                    </div>
                                ` : ''}
                                ${s.comment ? `
                                    <div class="submission-comment">
                                        <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-1);">ğŸ’¬ æå‡ºæ™‚ã‚³ãƒ¡ãƒ³ãƒˆ:</div>
                                        <div style="font-size: var(--font-size-sm);">${escapeHtml(s.comment)}</div>
                                    </div>
                                ` : ''}
                                ${s.status === 'rejected' && s.reviewComment ? `
                                    <div class="submission-feedback submission-feedback--rejected">
                                        <div style="font-size: var(--font-size-xs); font-weight: 500; margin-bottom: var(--space-1);">âš ï¸ å·®æˆ»ã—ã‚³ãƒ¡ãƒ³ãƒˆ:</div>
                                        <div style="font-size: var(--font-size-sm);">${escapeHtml(s.reviewComment)}</div>
                                    </div>
                                ` : ''}
                                ${s.status === 'approved' && s.reviewComment ? `
                                    <div class="submission-feedback submission-feedback--approved">
                                        <div style="font-size: var(--font-size-xs); font-weight: 500; margin-bottom: var(--space-1);">âœ… æ‰¿èªã‚³ãƒ¡ãƒ³ãƒˆ:</div>
                                        <div style="font-size: var(--font-size-sm);">${escapeHtml(s.reviewComment)}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = html;
            }

            // Start working button
            document.getElementById('start-working-btn').addEventListener('click', async () => {
                if (!selectedTaskId) return;
                try {
                    await DataManager.updateAssignment(selectedTaskId, { status: 'in_progress' });
                    showToast('ä½œæ¥­é–‹å§‹', 'ã‚¿ã‚¹ã‚¯ã‚’ä½œæ¥­ä¸­ã«å¤‰æ›´ã—ã¾ã—ãŸ');
                    await loadTasks();
                    selectTask(selectedTaskId);
                } catch (e) {
                    console.error('Error:', e);
                    showToast('ã‚¨ãƒ©ãƒ¼', 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            });

            // Submit button
            document.getElementById('submit-btn').addEventListener('click', async () => {
                if (!selectedTaskId) return;
                const url = document.getElementById('submit-url').value;
                const comment = document.getElementById('submit-comment').value;

                try {
                    await DataManager.createSubmission({
                        assignmentId: selectedTaskId,
                        stage: 'submission',
                        url,
                        comment
                    });
                    showToast('æå‡ºå®Œäº†', 'æˆæœç‰©ã‚’æå‡ºã—ã¾ã—ãŸ');
                    await loadTasks();
                    selectTask(selectedTaskId);
                } catch (e) {
                    console.error('Error:', e);
                    showToast('ã‚¨ãƒ©ãƒ¼', 'æå‡ºã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            });

            // Helpers
            function showError(msg) {
                const errorEl = document.getElementById('login-error');
                errorEl.textContent = msg;
                errorEl.style.display = 'block';
            }

            function showToast(title, message) {
                const toast = document.getElementById('toast');
                document.getElementById('toast-message').textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            function formatDate(date) {
                return date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
            }

            function formatDateTime(date) {
                return date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'short', day: 'numeric' }) + ' ' +
                       date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            }

            async function hashPassword(password) {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }
        });
    </script>
</body>

</html>
